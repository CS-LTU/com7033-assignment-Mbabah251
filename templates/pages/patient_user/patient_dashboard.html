{% extends "pages/patient_user/patient_layout.html" %} {% block title %}Patient
Dashboard{% endblock %} {% block patient_content %}

<div class="mb-8">
  <h1 class="text-3xl font-bold text-gray-800">
    Welcome, {{ patient.first_name }}! ðŸ‘‹
  </h1>
  <p class="text-gray-600 mt-1">
    Your personal health summary and assessment records
  </p>
</div>

<div class="bg-white shadow-md rounded-lg p-6 mb-10">
  <h2 class="text-xl font-semibold text-blue-700 mb-4">Bio Data</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
    <p>
      <span class="font-semibold">First Name:</span> {{ patient.first_name }}
    </p>
    <p><span class="font-semibold">Last Name:</span> {{ patient.last_name }}</p>

    <p><span class="font-semibold">Email:</span> {{ patient.email }}</p>
    <p><span class="font-semibold">Gender:</span> {{ patient.gender }}</p>

    <p>
      <span class="font-semibold">Date of Birth:</span> {{ patient.date_of_birth
      }}
    </p>
  </div>
</div>

<!-- Emergency Contacts Card -->
<div class="bg-white shadow-md rounded-lg p-6 mb-10">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-semibold text-blue-700">My Emergency Contacts</h2>
    <button
      onclick="openModal('addContactModal')"
      class="px-4 py-2 bg-[#0077b6] text-white rounded-lg transition text-sm font-medium"
    >
      Add Contact
    </button>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-300">
      <thead class="bg-gray-100">
        <tr>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            ID
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            First Name
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Last Name
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Phone Number
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Relationship
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Actions
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        {% if emergency_contacts %} {% for contact in emergency_contacts %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3 text-sm text-gray-800">{{ loop.index }}</td>
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ contact.first_name }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ contact.last_name }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ contact.phone_number }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ contact.relationship }}
          </td>
          <td class="px-4 py-3 text-sm flex items-center">
            <button
              onclick="openEditContactModal('{{ contact._id }}', '{{ contact.first_name }}', '{{ contact.last_name }}', '{{ contact.phone_number }}', '{{ contact.relationship }}')"
              class="px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition text-xs font-medium mr-2"
            >
              Edit
            </button>
            <button
              onclick="openDeleteContactModal('{{ contact._id }}', '{{ contact.first_name }}', '{{ contact.last_name }}')"
              class="px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition text-xs font-medium"
            >
              Delete
            </button>
          </td>
        </tr>
        {% endfor %} {% else %}
        <tr>
          <td colspan="6" class="text-center py-8 text-gray-500">
            <p class="text-lg font-medium">No emergency contacts found.</p>
            <p class="text-sm">
              Click "Add Contact" to add your emergency contacts.
            </p>
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

<div
  id="editContactModal"
  class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"
>
  <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
    <h3 class="text-xl font-bold mb-4 text-gray-900">Edit Emergency Contact</h3>
    <form id="editContactForm" method="POST" action="">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label class="block text-sm font-medium mb-1">First Name</label>
          <input
            type="text"
            name="first_name"
            id="edit_first_name"
            required
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-400"
          />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Last Name</label>
          <input
            type="text"
            name="last_name"
            id="edit_last_name"
            required
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-400"
          />
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label class="block text-sm font-medium mb-1">Relationship</label>
          <select
            name="relationship"
            id="edit_relationship"
            required
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-400"
          >
            <option value="">Select</option>
            <option value="Spouse">Spouse</option>
            <option value="Parent">Parent</option>
            <option value="Sibling">Sibling</option>
            <option value="Family">Family</option>
            <option value="Friend">Friend</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Phone Number</label>
          <input
            type="text"
            name="phone_number"
            id="edit_phone_number"
            required
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-400"
          />
        </div>
      </div>
      <div class="flex gap-3 justify-end">
        <button
          type="button"
          onclick="closeModal('editContactModal')"
          class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition font-medium text-sm"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition font-medium text-sm"
        >
          Update
        </button>
      </div>
    </form>
  </div>
</div>

<div
  id="deleteContactModal"
  class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"
>
  <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
    <h3 class="text-xl font-bold mb-4 text-gray-900">Confirm Delete</h3>
    <p class="text-gray-700 mb-6">
      Are you sure you want to delete
      <span id="deleteContactName" class="font-semibold"></span>? This action
      cannot be undone.
    </p>
    <form id="deleteContactForm" method="POST" action="">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <div class="flex gap-3 justify-end">
        <button
          type="button"
          onclick="closeModal('deleteContactModal')"
          class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition font-medium text-sm"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition font-medium text-sm"
        >
          Confirm
        </button>
      </div>
    </form>
  </div>
</div>

<div class="bg-white shadow-md rounded-lg p-6">
  <h2 class="text-xl font-semibold text-blue-700 mb-4">Assessment History</h2>

  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-300">
      <thead class="bg-gray-100">
        <tr>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Work Type
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Marital Status
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Residence Type
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Hypertension
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Smoking Status
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Avg Glucose
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            BMI
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Stroke
          </th>
          <th
            class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase"
          >
            Date
          </th>
        </tr>
      </thead>

      <tbody class="divide-y divide-gray-200">
        {% if assessments %} {% for record in assessments %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ record.work_type.replace('_', ' ').title() }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ record.ever_married }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ record.residence_type }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ 'Yes' if record.hypertension == 1 else 'No' }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ record.smoking_status.replace('_', ' ').title() }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ record.avg_glucose_level }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-800">{{ record.bmi }}</td>
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ 'Yes' if record.stroke == 1 else 'No' }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-800">
            {{ record.created_at|format_assessment_date }}
          </td>
        </tr>
        {% endfor %} {% else %}
        <tr>
          <td colspan="9" class="text-center py-8 text-gray-500">
            <p class="text-lg font-medium">No assessment records found.</p>
            <p class="text-sm">No assessments have been conducted yet.</p>
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

<div
  id="addContactModal"
  class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"
>
  <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
    <h3 class="text-xl font-bold mb-4 text-gray-900">Add Emergency Contact</h3>
    <form
      id="addContactForm"
      method="POST"
      action="{{ url_for('add_emergency_contact') }}"
    >
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label class="block text-sm font-medium mb-1">First Name</label>
          <input
            type="text"
            name="first_name"
            required
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-400"
          />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Last Name</label>
          <input
            type="text"
            name="last_name"
            required
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-400"
          />
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label class="block text-sm font-medium mb-1">Relationship</label>
          <select
            name="relationship"
            required
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-400"
          >
            <option value="">Select</option>
            <option value="Spouse">Spouse</option>
            <option value="Parent">Parent</option>
            <option value="Sibling">Sibling</option>
            <option value="Family">Family</option>
            <option value="Friend">Friend</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Phone Number</label>
          <input
            type="text"
            name="phone_number"
            required
            placeholder="0812345678"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-400"
          />
        </div>
      </div>
      <div class="flex gap-3 justify-end">
        <button
          type="button"
          onclick="closeModal('addContactModal')"
          class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition font-medium text-sm"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-[#0077b6] text-white rounded-lg transition font-medium text-sm"
        >
          Create Contact
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  function openModal(modalId) {
    const modal = document.getElementById(modalId);
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }

  function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    modal.classList.add("hidden");
    modal.classList.remove("flex");
  }

  function openEditContactModal(
    contactId,
    firstName,
    lastName,
    phoneNumber,
    relationship
  ) {
    document.getElementById("edit_first_name").value = firstName;
    document.getElementById("edit_last_name").value = lastName;
    document.getElementById("edit_phone_number").value = phoneNumber;
    document.getElementById("edit_relationship").value = relationship;
    document.getElementById("editContactForm").action =
      "/patient/emergency-contact/" + contactId + "/update";

    openModal("editContactModal");
  }

  function openDeleteContactModal(contactId, firstName, lastName) {
    document.getElementById("deleteContactName").textContent =
      firstName + " " + lastName;
    document.getElementById("deleteContactForm").action =
      "/patient/emergency-contact/" + contactId + "/delete";

    openModal("deleteContactModal");
  }
</script>

{% endblock %}