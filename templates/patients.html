{% extends "base.html" %}

{% block title %}Patients List{% endblock %}

{% block content %}

<!-- Main wrapper for the patient dashboard page -->
<div class="patients-container">

    <!-- Page header section -->
    <div class="patients-header">
        <h1>ğŸ“‹ Patient Management System</h1>
        <p>Welcome to the Medical Centre Patient Portal</p>
    </div>

    <!-- Logged-in user greeting and logout button -->
    <div class="user-welcome">
        <div class="user-info">ğŸ‘‹ Welcome, <strong>{{ user }}</strong></div>
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    </div>

    <!-- Flash messages for feedback (success, warning, error, etc.) -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Patients displayed in grid layout -->
    <div class="patients-grid">

        <!-- Loop through each patient and render a card -->
        {% for patient in patients %}
        <div class="patient-card">

            <!-- Card header showing patient name and ID -->
            <div class="card-header">
                <h3>{{ patient.name }}</h3>
                <p>ID: #{{ patient.id }}</p>
            </div>

            <!-- Card body containing patient personal and medical info -->
            <div class="card-body">

                <div class="info-row">
                    <span class="info-label">Age:</span>
                    <span class="info-value">{{ patient.age }} years</span>
                </div>

                <div class="info-row">
                    <span class="info-label">Gender:</span>
                    <span class="info-value">{{ patient.gender }}</span>
                </div>

                <div class="info-row">
                    <span class="info-label">Blood Type:</span>
                    <span class="info-value">{{ patient.blood_type }}</span>
                </div>

                <div class="info-row">
                    <span class="info-label">Condition:</span>
                    <span class="info-value">{{ patient.condition }}</span>
                </div>

                <div class="info-row">
                    <span class="info-label">Last Visit:</span>
                    <span class="info-value">{{ patient.last_visit }}</span>
                </div>

                <!-- Status badge with dynamic class based on status value -->
                <div class="info-row">
                    <span class="info-label">Status:</span>
                    <span class="status-badge status-{{ patient.status.lower() }}">
                        â— {{ patient.status }}
                    </span>
                </div>

            </div>

            <!-- Footer with link to detailed patient profile -->
            <div class="card-footer">
                <a href="{{ url_for('patient_detail', patient_id=patient.id) }}" class="view-btn">
                    ğŸ‘ï¸ View Details
                </a>
            </div>

        </div>
        {% endfor %}
        <!-- End of patient loop -->

    </div>

    <!-- Footer showing record count and last updated timestamp -->
    <div class="patients-footer">
        <p>Showing {{ patients|length }} patients | Last Updated: {{ now().strftime('%Y-%m-%d %H:%M') }}</p>
    </div>

</div>

{% endblock %}
